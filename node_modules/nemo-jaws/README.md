# nemo-jaws

Takes advantage of the restful Jaws interface published by the Quality Infrastructure Team. Construct RESTful calls using 
the API provided by the `nemo.jaws` function (see examples and documentation below) and the RESTful endpoints provided by the QI team:
http://jaws.corp.ebay.com/v1/QIJawsServices/ (swagger doc)

For help with any endpoint related problems, please contact: DL-PP-RestJaws-Dev@corp.ebay.com

## Installation

1. Please install nemo to your project.
2. Add this plugin to your package.json dev dependencies ("nemo-jaws": "^1.0.0")
3. npm install
4. Add following to your "plugins" configuration for nemo (full config below):

```json
{
   "driver": {
       "browser": "phantomjs"
   },
   "plugins": {
       "jaws": {
           "module": "nemo-jaws",
           "arguments": ["STAGE2MD052", "http://jaws.corp.ebay.com/v1/QIJawsServices/restservices"]
       }
   }
}
```

## Usage

The `user-test.js` script illustrates how to do query parameter substitutions:

```javascript
/*global describe:true, it:true, before:true, after:true */
"use strict";

var assert = require('assert'),
    Nemo = require('nemo'),
    nemo = {};

describe('@nemo-jaws.user@', function () {
    before(function (done) {
        nemo = Nemo(function (err) {
            if (err !== null) {
                done(err);
                return;
            }
            done();
        });
    });
    after(function (done) {
        nemo.driver.quit();
        done();
    });

    it('should create a user, do a get on that user, do a put on that user', function (done) {
        var email = '';
        var accountNumber = 0;
        nemo.jaws({
            restPath: '/user',
            method: 'post',
            data: {
                'country': 'US'
            }
        }).then(function(user) {
            email = user.emailAddress;
            accountNumber = user.accountNumber;
            return nemo.jaws({
                restPath: '/user/findByEmail',
                method: 'get',
                parameters: {
                    emailAddress: email
                }
            });
        }).then(function(user) {
            assert.equal(user.emailAddress, email);
            done();
        }, function (err) {
            done(err);
        });
    });

});
```

The `query-test.js` script illustrates how to do path substitutions:

```javascript
/*global describe:true, it:true, before:true, after:true */
"use strict";

var assert = require('assert'),
	nemo = {},
    Nemo = require('nemo');

describe('@nemo-jaws.query@', function () {
    before(function (done) {
        nemo = Nemo(function (err) {
            if (err !== null) {
                done(err);
                return;
            }
            done();
        });
    });
    after(function (done) {
        nemo.driver.quit();
        done();
    });
    it('should properly run a query', function (done) {
        var email = '';
        var accountNumber = 0;
        return nemo.jaws({
            restPath: '/database/${databaseName}/query',
            method: 'post',
            path: {
                databaseName: 'RUSER'
            },
            data: {
                sqlQuery: 'select * from wuser_norm_address where rownum<10'
            }
        }).then(function(data) {
            assert.ok(data && data.row && data.row.length && data.row.length == 9);

            done();
        }, function (err) {
            done(err);
        });
    });
});

```

## nemo.jaws

The nemo-jaws plugin adds a `nemo.jaws` function to your nemo object. It has the folliwng properties:

* `@argument {Object}` - Provide all the information to make a RESTful Jaws call. All possible properties are:
  * `restPath` - path to the endpoint you are using, e.g. `/database/${databaseName}/query` (note this example will 
  require path substitution)
  * `method` - get, post, put 
  * `data` (optional) - depending on the endpoint you may or may not need to provide a data payload 
  * `path` (optional) - if the `restPath` requires a path substitution, that (or those) will go here 
  * `parameters` (optional) - if the endpoint takes query parameters, put those here. Name them with the actual names 
  and the plugin will handle the rest
* `@returns {Promise}` - Uses the selenium-webdriver Promise implementation. Make sure to define an error callback so 
you can capture any errors the plugin might throw

## Logging/Debugging

To get detailed log and error messages, set your `DEBUG` environment variable to either `nemo-jaws:*` (for just nemo-jaws log info) or `nemo*` for all Nemo log messages.
